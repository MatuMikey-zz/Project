<!DOCTYPE html>
<!-- saved from url=(0081)http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm -->
<html lang="en-US"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta name="viewport" content="width=device-width">
	<title>Pulse Width Modulation (PWM) | M5</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://umassamherstm5.org/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://umassamherstm5.org/wp-content/themes/twentythirteen/js/html5.js"></script>
	<![endif]-->
	<link rel="dns-prefetch" href="http://ajax.googleapis.com/">
<link rel="dns-prefetch" href="http://fonts.googleapis.com/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link href="https://fonts.gstatic.com/" crossorigin="" rel="preconnect">
<link rel="alternate" type="application/rss+xml" title="M5 » Feed" href="http://umassamherstm5.org/feed">
<link rel="alternate" type="application/rss+xml" title="M5 » Comments Feed" href="http://umassamherstm5.org/comments/feed">
<link rel="alternate" type="application/rss+xml" title="M5 » Pulse Width Modulation (PWM) Comments Feed" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm/feed">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/umassamherstm5.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.1"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b===c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Pulse Width Modulation (PWM) _ M5_files/wp-emoji-release.min.js.download" type="text/javascript" defer=""></script>
		<link rel="stylesheet" href="./Pulse Width Modulation (PWM) _ M5_files/galleria.classic.css" id="galleria-theme"><style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-syntax-css-css" href="./Pulse Width Modulation (PWM) _ M5_files/wp-syntax.css" type="text/css" media="all">
<link rel="stylesheet" id="twentythirteen-fonts-css" href="./Pulse Width Modulation (PWM) _ M5_files/css" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="./Pulse Width Modulation (PWM) _ M5_files/genericons.css" type="text/css" media="all">
<link rel="stylesheet" id="twentythirteen-style-css" href="./Pulse Width Modulation (PWM) _ M5_files/style.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentythirteen-ie-css'  href='http://umassamherstm5.org/wp-content/themes/twentythirteen/css/ie.css?ver=2013-07-18' type='text/css' media='all' />
<![endif]-->
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/jquery.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/galleria-1.2.6.min.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/galleria-common.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/galleria.classic.min.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/jquery.js(1).download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/jquery-migrate.min.js.download"></script>
<link rel="https://api.w.org/" href="http://umassamherstm5.org/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://umassamherstm5.org/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://umassamherstm5.org/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.8.1">
<link rel="canonical" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm">
<link rel="shortlink" href="http://umassamherstm5.org/?p=2843">
<link rel="alternate" type="application/json+oembed" href="http://umassamherstm5.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fumassamherstm5.org%2Ftech-tutorials%2Fpic32-tutorials%2Fpic32mx220-tutorials%2Fpwm">
<link rel="alternate" type="text/xml+oembed" href="http://umassamherstm5.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fumassamherstm5.org%2Ftech-tutorials%2Fpic32-tutorials%2Fpic32mx220-tutorials%2Fpwm&amp;format=xml">
			<script type="text/javascript">
				var get_sizes = null;
							</script>
			<style type="text/css" id="twentythirteen-header-css">
			.site-header {
			background: url(http://umassamherstm5.org/wp-content/uploads/2017/03/cropped-0225171422-100.jpg) no-repeat scroll top;
			background-size: 1600px auto;
		}
		@media (max-width: 767px) {
			.site-header {
				background-size: 768px auto;
			}
		}
		@media (max-width: 359px) {
			.site-header {
				background-size: 360px auto;
			}
		}
		</style>
			<style type="text/css" id="wp-custom-css">
			/*
You can add your own CSS here.

Click the help icon above to learn more.
*/

.site-title{
	color: beige;
	font-family: "Source Sans Pro", Helvetica, sans-serif;

}
.site-description{
	color: beige;
	font-family: "Source Sans Pro", Helvetica, sans-serif;
}		</style>
	</head>

<body class="page-template-default page page-id-2843 page-child parent-pageid-2911">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<a class="home-link" href="http://umassamherstm5.org/" title="M5" rel="home">
				<h1 class="site-title">M5</h1>
				<h2 class="site-description"></h2>
			</a>

			<div id="navbar" class="navbar">
				<nav id="site-navigation" class="navigation main-navigation" role="navigation">
					<button class="menu-toggle">Menu</button>
					<a class="screen-reader-text skip-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#content" title="Skip to content">Skip to content</a>
					<div class="menu-functional-menu-container"><ul id="primary-menu" class="nav-menu"><li id="menu-item-1327" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1327"><a href="http://umassamherstm5.org/">Home</a></li>
<li id="menu-item-1328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1328"><a href="http://umassamherstm5.org/m5-info/about">About M5</a></li>
<li id="menu-item-4057" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4057"><a href="http://umassamherstm5.org/newsletter">News and Events</a></li>
<li id="menu-item-1771" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-has-children menu-item-1771"><a href="http://umassamherstm5.org/tech-tutorials">Learn</a>
<ul class="sub-menu">
	<li id="menu-item-2897" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-2897"><a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials">PIC32 Tutorials</a></li>
</ul>
</li>
<li id="menu-item-1332" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1332"><a href="http://umassamherstm5.org/m5-info/contact-us">Contact Us</a></li>
</ul></div>					<form role="search" method="get" class="search-form" action="http://umassamherstm5.org/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search …" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="Search">
			</form>				</nav><!-- #site-navigation -->
			</div><!-- #navbar -->
		</header><!-- #masthead -->

		<div id="main" class="site-main">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

						
				<article id="post-2843" class="post-2843 page type-page status-publish hentry">
					<header class="entry-header">
						
						<h1 class="entry-title">Pulse Width Modulation (PWM)</h1>
					</header><!-- .entry-header -->

					<div class="entry-content">
						<p>The PIC32 and most microcontrollers can deal with digital inputs, digital outputs, and analog inputs but not analog outputs. At least not directly… Using Pulse Width Modulation (PWM), the PIC32 can use a digital I/O pin to effectively get analog output.</p>
<p>This is a square wave, nothing special, just a square wave.<br>
<a href="./Pulse Width Modulation (PWM) _ M5_files/PWM-square-wave.png"><img class="aligncenter size-full wp-image-2844" title="PWM square wave" src="./Pulse Width Modulation (PWM) _ M5_files/PWM-square-wave.png" alt="" width="593" height="82" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-square-wave.png 593w, http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-square-wave-300x41.png 300w" sizes="(max-width: 593px) 100vw, 593px"></a></p>
<p>Since the HIGH time is equal to the LOW time, a square wave would be considered to have a 50% <em>duty cycle</em>. PIC32’s digital output voltage is 3.3V and so the average voltage of this square wave is half of that or 1.65V. In fact, if we put this square wave through a low-pass filter, the output would be a flat 1.65V!<br>
<a href="./Pulse Width Modulation (PWM) _ M5_files/PWM-10.png"><img class="aligncenter size-full wp-image-2846" title="PWM 10" src="./Pulse Width Modulation (PWM) _ M5_files/PWM-10.png" alt="" width="592" height="81" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10.png 592w, http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10-300x41.png 300w" sizes="(max-width: 592px) 100vw, 592px"></a><br>
The wave above has a 10% duty cycle and so its average voltage is 0.33V. So to change the analog voltage, only the duty cycle needs to change!</p>
<p>The frequency chosen for PWM is application dependent. For example, the PWM frequency for commercial train controllers is 16,125Hz. This is a balance between noise and torque. Human hearing is considered to be from 20Hz to 20kHz but for most people, sounds as high as 16kHz are very difficult to hear. Higher than 16,125Hz and the loss of torque becomes too much.</p>
<h2>PWM Configuration</h2>
<p>On the PIC32, PWM is a function of the <em>output compare module</em>. The output compare module compares the contents of the OCxR register to the value in a timer. As the timer continues to loop from a value of ‘0’ to a value equal to its period register (this is normal timer operation), the timer will match the contents of the output compare register (i.e. TMRy = OCxR) exactly once. When a match occurs, the output compare module will… do something.</p>
<p>In PWM mode, the output pin stays HIGH until the timer matches the contents of OCxR at which time the pin goes LOW. For smooth operation, the programmer must write to the OCxRS register. This is the OCxR <strong><i>S</i></strong>lave register. The contents of the OCxRS register are loaded into OCxR at every timer overflow. The diagram below taken from Microchip’s output compare reference manual shows this.<br>
<a href="./Pulse Width Modulation (PWM) _ M5_files/PWM-Events.png"><img class="aligncenter size-full wp-image-2848" title="PWM Events" src="./Pulse Width Modulation (PWM) _ M5_files/PWM-Events.png" alt="" width="507" height="216" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-Events.png 507w, http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-Events-300x127.png 300w" sizes="(max-width: 507px) 100vw, 507px"></a></p>
<p>The only timers that can be used are Timer2, Timer3, and the 32-bit combination timer of these two, Timer23. From the reference manual equation 16-1 (TPB is the peripheral clock period which for most applications in these tutorials has been equal to the PIC32 system clock):</p>
<p style="text-align: center;">
PWM Period = [(PR + 1) * TPB * (TMR Prescale Value)]</p>
<p>from which we can calculate:</p>
<p style="text-align: center;">
PR = [FPB / (PWM Frequency * TMR Prescale Value)] – 1</p>
<p>Note that a timer period value of N will produce N+1 PWM counts. So if a value of 9 is written to PRy, this will result in a period with 10 time counts. In this example, if the same value has been written to OCxRS and PRy, the OCx pin will be LOW for one time count and HIGH for the 9 others.</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">/* The following code will output a steady PWM wave with duty cycle equal
 * to the constant DUTY_CYCLE (10% below) and frequency equal to 
 * the constant PWM_FREQ (16kHz below)
 * 
 * RB7 is the output pin
 */</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Include Header Files</span>
<span style="color: #339933;">#include &lt;p32xxxx.h&gt;</span>
<span style="color: #339933;">#include &lt;plib.h&gt;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Configuration Bits</span>
<span style="color: #339933;">#pragma config FNOSC = FRCPLL       // Internal Fast RC oscillator (8 MHz) w/ PLL</span>
<span style="color: #339933;">#pragma config FPLLIDIV = DIV_2     // Divide FRC before PLL (now 4 MHz)</span>
<span style="color: #339933;">#pragma config FPLLMUL = MUL_20     // PLL Multiply (now 80 MHz)</span>
<span style="color: #339933;">#pragma config FPLLODIV = DIV_2     // Divide After PLL (now 40 MHz)</span>
                                    <span style="color: #666666; font-style: italic;">// see figure 8.1 in datasheet for more info</span>
<span style="color: #339933;">#pragma config FWDTEN = OFF         // Watchdog Timer Disabled</span>
<span style="color: #339933;">#pragma config ICESEL = ICS_PGx1    // ICE/ICD Comm Channel Select</span>
<span style="color: #339933;">#pragma config JTAGEN = OFF         // Disable JTAG</span>
<span style="color: #339933;">#pragma config FSOSCEN = OFF        // Disable Secondary Oscillator</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Defines</span>
<span style="color: #339933;">#define SYSCLK  40000000L</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// Note that 612Hz (PR2=0xffff) is the lowest pwm frequency with our configuration</span>
<span style="color: #666666; font-style: italic;">// : To get lower, use a timer prescaler or use the 32-bit timer mode</span>
<span style="color: #339933;">#define PWM_FREQ    16000</span>
<span style="color: #339933;">#define DUTY_CYCLE  10</span>
&nbsp;
<span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
    SYSTEMConfigPerformance<span style="color: #009900;">(</span>SYSCLK<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">// Set OC1 to pin RB7 with peripheral pin select</span>
    RPB7Rbits.<span style="color: #202020;">RPB7R</span> <span style="color: #339933;">=</span> <span style="color: #208080;">0x0005</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">// Configure standard PWM mode for output compare module 1</span>
    OC1CON <span style="color: #339933;">=</span> <span style="color: #208080;">0x0006</span><span style="color: #339933;">;</span> 
&nbsp;
    <span style="color: #666666; font-style: italic;">// A write to PRy configures the PWM frequency</span>
    <span style="color: #666666; font-style: italic;">// PR = [FPB / (PWM Frequency * TMR Prescale Value)] – 1</span>
    <span style="color: #666666; font-style: italic;">// : note the TMR Prescaler is 1 and is thus ignored</span>
    PR2 <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>SYSCLK <span style="color: #339933;">/</span> PWM_FREQ<span style="color: #009900;">)</span> <span style="color: #339933;">-</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">// A write to OCxRS configures the duty cycle</span>
    <span style="color: #666666; font-style: italic;">// : OCxRS / PRy = duty cycle</span>
    OC1RS <span style="color: #339933;">=</span> <span style="color: #009900;">(</span>PR2 <span style="color: #339933;">+</span> <span style="color: #0000dd;">1</span><span style="color: #009900;">)</span> <span style="color: #339933;">*</span> <span style="color: #009900;">(</span><span style="color: #009900;">(</span><span style="color: #993333;">float</span><span style="color: #009900;">)</span>DUTY_CYCLE <span style="color: #339933;">/</span> <span style="color: #0000dd;">100</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
    T2CONSET <span style="color: #339933;">=</span> <span style="color: #208080;">0x8000</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">// Enable Timer2, prescaler 1:1</span>
    OC1CONSET <span style="color: #339933;">=</span> <span style="color: #208080;">0x8000</span><span style="color: #339933;">;</span>     <span style="color: #666666; font-style: italic;">// Enable Output Compare Module 1</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">// loop indefinitely</span>
    <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span> <span style="color: #0000dd;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">/* The following code will output a steady PWM wave with duty cycle equal
 * to the constant DUTY_CYCLE (10% below) and frequency equal to 
 * the constant PWM_FREQ (16kHz below)
 * 
 * RB7 is the output pin
 */

// Include Header Files
#include &lt;p32xxxx.h&gt;
#include &lt;plib.h&gt;

// Configuration Bits
#pragma config FNOSC = FRCPLL       // Internal Fast RC oscillator (8 MHz) w/ PLL
#pragma config FPLLIDIV = DIV_2     // Divide FRC before PLL (now 4 MHz)
#pragma config FPLLMUL = MUL_20     // PLL Multiply (now 80 MHz)
#pragma config FPLLODIV = DIV_2     // Divide After PLL (now 40 MHz)
                                    // see figure 8.1 in datasheet for more info
#pragma config FWDTEN = OFF         // Watchdog Timer Disabled
#pragma config ICESEL = ICS_PGx1    // ICE/ICD Comm Channel Select
#pragma config JTAGEN = OFF         // Disable JTAG
#pragma config FSOSCEN = OFF        // Disable Secondary Oscillator

// Defines
#define SYSCLK  40000000L

// Note that 612Hz (PR2=0xffff) is the lowest pwm frequency with our configuration
// : To get lower, use a timer prescaler or use the 32-bit timer mode
#define PWM_FREQ    16000
#define DUTY_CYCLE  10

int main(void)
{
    SYSTEMConfigPerformance(SYSCLK);

    // Set OC1 to pin RB7 with peripheral pin select
    RPB7Rbits.RPB7R = 0x0005;

    // Configure standard PWM mode for output compare module 1
    OC1CON = 0x0006; 

    // A write to PRy configures the PWM frequency
    // PR = [FPB / (PWM Frequency * TMR Prescale Value)] – 1
    // : note the TMR Prescaler is 1 and is thus ignored
    PR2 = (SYSCLK / PWM_FREQ) - 1;

    // A write to OCxRS configures the duty cycle
    // : OCxRS / PRy = duty cycle
    OC1RS = (PR2 + 1) * ((float)DUTY_CYCLE / 100);

    T2CONSET = 0x8000;      // Enable Timer2, prescaler 1:1
    OC1CONSET = 0x8000;     // Enable Output Compare Module 1

    // loop indefinitely
    while( 1);

    return 1;
}</p></div>

<p>This code generated the following continuous waveform on pin RB7. Note that the frequency and duty cycle are close to but not exactly as programmed due to clock jitter since we’re using the internal 8MHz FRC as our source.<br>
<a href="http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10-with-descriptors.png"><img src="./Pulse Width Modulation (PWM) _ M5_files/PWM-10-with-descriptors-1024x258.png" alt="" title="PWM 10 with descriptors" width="1024" height="258" class="aligncenter size-large wp-image-2853" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10-with-descriptors-1024x258.png 1024w, http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10-with-descriptors-300x75.png 300w, http://umassamherstm5.org/wp-content/uploads/2012/05/PWM-10-with-descriptors.png 1210w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>If the duty cycle needs to be modified every period, it’s recommended to enable the timer’s interrupts and do any modification there. This isn’t necessary but gives the programmer the most control. For applications like playing audio with PWM (which can sound pretty good with a quality low-pass filter), it becomes necessary to use the timer’s interrupts.</p>
											</div><!-- .entry-content -->

					<footer class="entry-meta">
											</footer><!-- .entry-meta -->
				</article><!-- #post -->

				
<div id="comments" class="comments-area">

			<h2 class="comments-title">
			8 thoughts on “<span>Pulse Width Modulation (PWM)</span>”		</h2>

		<ol class="comment-list">
					<li id="comment-794" class="comment even thread-even depth-1 parent">
			<article id="div-comment-794" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/b95d39d05dd4e66fe3ee89a53a7d60fd.png" srcset="http://2.gravatar.com/avatar/b95d39d05dd4e66fe3ee89a53a7d60fd?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">SHALAM</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-794">
							<time datetime="2012-08-26T09:41:52+00:00">
								26 August 2012 at 09:41							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>HI,<br>
i am using pic32mxXXXXL, i am trying to generate 40khz pwm. recently i am using pic18 to generate similar function it is very simple but difficult with alot of settings when it come to pic32. below are my codes for 40khz pwm:</p>
<p>#include<br>
#include  &lt;p32mx460f512.h	//I ADD MYSELF</p>
<p>int main(void)<br>
{<br>
	//INT CLK IS RUNNING AT 80MHZ, REFER TO OSC BLOCK DIAGRAM<br>
	OSCTUNbits.TUN=OOOOO;	//OSC RUNS AT CALIBRATED FREQ</p>
<p>	//PLL inputdivider is forced to ‘2’ to provide a 4 MHz input to the PLL<br>
	//REFER TO 4.2.1.6.2 FAMILY DATASHEET<br>
	//Fast RC oscillator with PLL module via Postscaler (FRCPLL)<br>
	OSCCONbits.COSC=001;	</p>
<p>	//4MHZ IS MULTIPLIED BY 20=80MHZ<br>
	OSCCONbits.PLLMULT=101;	</p>
<p>	//NEW OSCILLATOR CONFIGURATION BITS<br>
	//Fast Internal RC oscillator with PLL module via postscaler (FRCPLL)<br>
	OSCCONbits.NOSC=001;</p>
<p>/*////////////////////////////END OF OSCILLATOR CONFIGURATION///////////////////////////////*/</p>
<p>	/* Enable timer1; external clock source;<br>
	synchronized timer; prescaler 1:1; */<br>
	OpenTimer1(T1_ON | T1_SOURCE_EXT | T1_SYNC_EXT_ON |<br>
	T1_PS_1_1);</p>
<p>	//</p>
<p>	//PWM SETTINGS NOT SURE ABT DUTY CYCLE<br>
	OC1R = 0x03E8; // Initialize primary Compare Register<br>
	OC1RS = 0x03E8; // Initialize secondary Compare Register<br>
	OC1CON = 0x0006; // Configure for PWM mode<br>
	PR2 = 0x07cf; // Set period FOR 40KHZ, FOSC@80MHZ</p>
<p>	{<br>
		// *** insert user code ***</p>
<p>	}<br>
}<br>
 i also trying to count back the 40khz tat i sent out by using compare function. if u can assist me, i'll be thankful</p>
<p>shahlam</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=794#respond" onclick="return addComment.moveForm( &quot;div-comment-794&quot;, &quot;794&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to SHALAM">Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-1777" class="comment odd alt depth-2">
			<article id="div-comment-1777" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/2fa7f8e51ad65d0040e5dec75c6f9afd.png" srcset="http://2.gravatar.com/avatar/2fa7f8e51ad65d0040e5dec75c6f9afd?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Esteban Viveros</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-1777">
							<time datetime="2013-02-27T03:00:41+00:00">
								27 February 2013 at 03:00							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, the OutputCompare modules only use de Timer2 or Timer3. You can’t use the Timer1 to generate de PWM.</p>
<p>Here is an example:</p>
<p>PR = ( FPBCLK / Frecuency) – 1;<br>
OpenTimer2(T2_ON | T2_PS_1_1 | T2_SOURCE_INT, PR);<br>
PWM = (PR+1) * ( (float) (DutyCycle/100) );<br>
OpenOC2(OC_ON | OC_PWM_FAULT_PIN_DISABLE | OC_TIMER2_SRC, PWM, 0);</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=1777#respond" onclick="return addComment.moveForm( &quot;div-comment-1777&quot;, &quot;1777&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to Esteban Viveros">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-814" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-814" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/47ebb5482745c1936f8d81a5357e837a.jpeg" srcset="http://1.gravatar.com/avatar/47ebb5482745c1936f8d81a5357e837a?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Dragec</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-814">
							<time datetime="2012-09-02T13:34:53+00:00">
								2 September 2012 at 13:34							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=814#respond" onclick="return addComment.moveForm( &quot;div-comment-814&quot;, &quot;814&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to Dragec">Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-1776" class="comment odd alt depth-2">
			<article id="div-comment-1776" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/2fa7f8e51ad65d0040e5dec75c6f9afd.png" srcset="http://2.gravatar.com/avatar/2fa7f8e51ad65d0040e5dec75c6f9afd?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Esteban Viveros</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-1776">
							<time datetime="2013-02-27T03:00:06+00:00">
								27 February 2013 at 03:00							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, the OutputCompare modules only use de Timer2 or Timer3. You can’t use the Timer1 to generate de PWM.</p>
<p>Here is an example: </p>
<p>    PR = ( FPBCLK / Frecuency) – 1;<br>
    OpenTimer2(T2_ON | T2_PS_1_1 | T2_SOURCE_INT, PR);<br>
    PWM  = (PR+1) * ( (float) (DutyCycle/100) );<br>
    OpenOC2(OC_ON | OC_PWM_FAULT_PIN_DISABLE | OC_TIMER2_SRC, PWM, 0);</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=1776#respond" onclick="return addComment.moveForm( &quot;div-comment-1776&quot;, &quot;1776&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to Esteban Viveros">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-858" class="comment even thread-even depth-1">
			<article id="div-comment-858" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/0a6580df852eb66c7bc70ddcab75136f.png" srcset="http://0.gravatar.com/avatar/0a6580df852eb66c7bc70ddcab75136f?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">SAM, Shamsul</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-858">
							<time datetime="2012-09-23T11:13:45+00:00">
								23 September 2012 at 11:13							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, thank you for your elaborate explanation on the PWM. I am actually trying to use the PIC32 OCM/PWM ports to fire an infrared code (that is, I am having a PIC32MX795F512 based board where the IR led is hooked up to pin OC2). I wonder if you could kindly help me to write a C32 code to fire the following Sony IR remote command (reference site <a href="http://www.sbprojects.com/knowledge/ir/sirc.php" rel="nofollow">http://www.sbprojects.com/knowledge/ir/sirc.php</a>):</p>
<p>PWM (port OC2) to be set to frequency = 40 kHz and sending 13 pulses as follows:<br>
pulse 1: HIGH for 2.4 msec , LOW for 0.6 msec<br>
pulse 2: HIGH for 1.2 msec , LOW for 0.6 msec<br>
pulse 3: HIGH for 1.2 msec , LOW for 0.6 msec<br>
pulse 4: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 5: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 6: HIGH for 1.2 msec , LOW for 0.6 msec<br>
pulse 7: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 8: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 9: HIGH for 1.2 msec , LOW for 0.6 msec<br>
pulse 10: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 11: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 12: HIGH for 0.6 msec , LOW for 0.6 msec<br>
pulse 13: HIGH for 0.6 msec , LOW for 0.6 msec</p>
<p>I really appreciate if you can spend some times to explain thru C coding to achieve the above task. Thank you, may god bless your kindness.</p>
<p>Regards: SAM, Malaysia</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=858#respond" onclick="return addComment.moveForm( &quot;div-comment-858&quot;, &quot;858&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to SAM, Shamsul">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-859" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-859" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/0a6580df852eb66c7bc70ddcab75136f.png" srcset="http://0.gravatar.com/avatar/0a6580df852eb66c7bc70ddcab75136f?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">SAM, Shamsul</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-859">
							<time datetime="2012-09-23T11:21:01+00:00">
								23 September 2012 at 11:21							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi again, I missed some info about my embedded profile as follows:</p>
<p>External xtal of 8 MHz, config to give the maximum frequency of 80 MHz to the core PIC32 processor, peripheral bus is at half of it (40 MHz).</p>
<p>Thank you.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=859#respond" onclick="return addComment.moveForm( &quot;div-comment-859&quot;, &quot;859&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to SAM, Shamsul">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-45479" class="pingback even thread-even depth-1">
			<div class="comment-body">
				Pingback: <a href="http://www.edaboard.com/thread350864.html#post1499595" rel="external nofollow" class="url">32 bit resolution PWM</a> 			</div>
</li><!-- #comment-## -->
		<li id="comment-49149" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-49149" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Pulse Width Modulation (PWM) _ M5_files/f204b5cd45087071c3379cda9d0b256c.png" srcset="http://0.gravatar.com/avatar/f204b5cd45087071c3379cda9d0b256c?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Paul Saffren</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#comment-49149">
							<time datetime="2016-09-22T15:27:27+00:00">
								22 September 2016 at 15:27							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you very much for posting the example code.  I was having trouble understanding the PIC32MX OC module set up and operation, and your explanation with example code REALLY helped me out.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm?replytocom=49149#respond" onclick="return addComment.moveForm( &quot;div-comment-49149&quot;, &quot;49149&quot;, &quot;respond&quot;, &quot;2843&quot; )" aria-label="Reply to Paul Saffren">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
		
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/pwm#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="http://umassamherstm5.org/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate="">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required="true" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required="true" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200"></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="2843" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="c5e7993873"></p><p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1532266110838"></form>
			</div><!-- #respond -->
	
</div><!-- #comments -->			
		</div><!-- #content -->
	</div><!-- #primary -->


		</div><!-- #main -->
		<footer id="colophon" class="site-footer" role="contentinfo">
			
			<div class="site-info">
								<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #page -->

				<script type="text/javascript">
				(function($){
					$(function(){
						$("img.flickr.square,img.flickr.thumbnail,img.flickr.small").flightbox({size_callback: get_sizes});
					});
				})(jQuery);
			</script>
		<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/form.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/wp-syntax.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/comment-reply.min.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/functions.js.download"></script>
<script type="text/javascript" src="./Pulse Width Modulation (PWM) _ M5_files/wp-embed.min.js.download"></script>

</body></html>