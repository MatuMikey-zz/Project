<!DOCTYPE html>
<!-- saved from url=(0091)http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration -->
<html lang="en-US"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta name="viewport" content="width=device-width">
	<title>Configuration | M5</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://umassamherstm5.org/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://umassamherstm5.org/wp-content/themes/twentythirteen/js/html5.js"></script>
	<![endif]-->
	<link rel="dns-prefetch" href="http://ajax.googleapis.com/">
<link rel="dns-prefetch" href="http://fonts.googleapis.com/">
<link rel="dns-prefetch" href="http://s.w.org/">
<link href="https://fonts.gstatic.com/" crossorigin="" rel="preconnect">
<link rel="alternate" type="application/rss+xml" title="M5 ¬ª Feed" href="http://umassamherstm5.org/feed">
<link rel="alternate" type="application/rss+xml" title="M5 ¬ª Comments Feed" href="http://umassamherstm5.org/comments/feed">
<link rel="alternate" type="application/rss+xml" title="M5 ¬ª Configuration Comments Feed" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration/feed">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/umassamherstm5.org\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.1"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b===c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Configuration _ M5_files/wp-emoji-release.min.js.download" type="text/javascript" defer=""></script>
		<link rel="stylesheet" href="./Configuration _ M5_files/galleria.classic.css" id="galleria-theme"><style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="wp-syntax-css-css" href="./Configuration _ M5_files/wp-syntax.css" type="text/css" media="all">
<link rel="stylesheet" id="twentythirteen-fonts-css" href="./Configuration _ M5_files/css" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="./Configuration _ M5_files/genericons.css" type="text/css" media="all">
<link rel="stylesheet" id="twentythirteen-style-css" href="./Configuration _ M5_files/style.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentythirteen-ie-css'  href='http://umassamherstm5.org/wp-content/themes/twentythirteen/css/ie.css?ver=2013-07-18' type='text/css' media='all' />
<![endif]-->
<script type="text/javascript" src="./Configuration _ M5_files/jquery.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/galleria-1.2.6.min.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/galleria-common.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/galleria.classic.min.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/jquery.js(1).download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/jquery-migrate.min.js.download"></script>
<link rel="https://api.w.org/" href="http://umassamherstm5.org/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://umassamherstm5.org/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://umassamherstm5.org/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 4.8.1">
<link rel="canonical" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration">
<link rel="shortlink" href="http://umassamherstm5.org/?p=2713">
<link rel="alternate" type="application/json+oembed" href="http://umassamherstm5.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fumassamherstm5.org%2Ftech-tutorials%2Fpic32-tutorials%2Fpic32mx220-tutorials%2Fconfiguration">
<link rel="alternate" type="text/xml+oembed" href="http://umassamherstm5.org/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fumassamherstm5.org%2Ftech-tutorials%2Fpic32-tutorials%2Fpic32mx220-tutorials%2Fconfiguration&amp;format=xml">
			<script type="text/javascript">
				var get_sizes = null;
							</script>
			<style type="text/css" id="twentythirteen-header-css">
			.site-header {
			background: url(http://umassamherstm5.org/wp-content/uploads/2017/03/cropped-0225171422-100.jpg) no-repeat scroll top;
			background-size: 1600px auto;
		}
		@media (max-width: 767px) {
			.site-header {
				background-size: 768px auto;
			}
		}
		@media (max-width: 359px) {
			.site-header {
				background-size: 360px auto;
			}
		}
		</style>
			<style type="text/css" id="wp-custom-css">
			/*
You can add your own CSS here.

Click the help icon above to learn more.
*/

.site-title{
	color: beige;
	font-family: "Source Sans Pro", Helvetica, sans-serif;

}
.site-description{
	color: beige;
	font-family: "Source Sans Pro", Helvetica, sans-serif;
}		</style>
	</head>

<body class="page-template-default page page-id-2713 page-child parent-pageid-2911">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<a class="home-link" href="http://umassamherstm5.org/" title="M5" rel="home">
				<h1 class="site-title">M5</h1>
				<h2 class="site-description"></h2>
			</a>

			<div id="navbar" class="navbar">
				<nav id="site-navigation" class="navigation main-navigation" role="navigation">
					<button class="menu-toggle">Menu</button>
					<a class="screen-reader-text skip-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#content" title="Skip to content">Skip to content</a>
					<div class="menu-functional-menu-container"><ul id="primary-menu" class="nav-menu"><li id="menu-item-1327" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1327"><a href="http://umassamherstm5.org/">Home</a></li>
<li id="menu-item-1328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1328"><a href="http://umassamherstm5.org/m5-info/about">About M5</a></li>
<li id="menu-item-4057" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4057"><a href="http://umassamherstm5.org/newsletter">News and Events</a></li>
<li id="menu-item-1771" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-has-children menu-item-1771"><a href="http://umassamherstm5.org/tech-tutorials">Learn</a>
<ul class="sub-menu">
	<li id="menu-item-2897" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-2897"><a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials">PIC32 Tutorials</a></li>
</ul>
</li>
<li id="menu-item-1332" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1332"><a href="http://umassamherstm5.org/m5-info/contact-us">Contact Us</a></li>
</ul></div>					<form role="search" method="get" class="search-form" action="http://umassamherstm5.org/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search ‚Ä¶" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="Search">
			</form>				</nav><!-- #site-navigation -->
			</div><!-- #navbar -->
		</header><!-- #masthead -->

		<div id="main" class="site-main">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

						
				<article id="post-2713" class="post-2713 page type-page status-publish hentry">
					<header class="entry-header">
						
						<h1 class="entry-title">Configuration</h1>
					</header><!-- .entry-header -->

					<div class="entry-content">
						<p>This tutorial will discuss:</p>
<ol>
<li>Config Bits</li>
<li>Using an external crystal oscillator</li>
<li>Optimizing the oscillator with the <code>SYSTEMConfigPerformance()</code> function</li>
<li>The <code>p32xxxx.h</code> and <code>plib.h</code> header files
</li></ol>
<h2>Config Bits</h2>
<p>The PIC32 configuration bits are a set of non-volatile options that define certain characteristics of the microcontroller. They are different from the program written in C or assembly in that config bits are stored in boot flash memory (instead of program flash memory) and accordingly affect the chip on a lower level.</p>
<p>Those familiar with AVRs should consider these to be the synonymous with <i>AVR fuses</i>. </p>
<p>To define these config bits, you would use the <code>#pragma</code> directive in the global section of code. </p>
<p>For example:</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#pragma config JTAGEN = OFF         // Disable JTAG</span>
<span style="color: #339933;">#pragma config FSOSCEN = OFF        // Disable secondary oscillator</span>
<span style="color: #339933;">#pragma config FNOSC = FRC          // use internal Fast RC oscillator (8MHz)</span>
<span style="color: #339933;">#pragma config FWDTEN = OFF         // Disable watchdog timer</span>
<span style="color: #339933;">#pragma config ICESEL = ICS_PGx1    // select pins to transfer program data on (ICSP pins)</span>
&nbsp;
<span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
    <span style="color: #666666; font-style: italic;">// ...main program here</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">#pragma config JTAGEN = OFF         // Disable JTAG
#pragma config FSOSCEN = OFF        // Disable secondary oscillator
#pragma config FNOSC = FRC          // use internal Fast RC oscillator (8MHz)
#pragma config FWDTEN = OFF         // Disable watchdog timer
#pragma config ICESEL = ICS_PGx1    // select pins to transfer program data on (ICSP pins)

int main(){
    // ...main program here
}</p></div>

<p>For more config bit info, see MPLAB X‚Äôs <i>help contents</i>. The particular page, which is chip specific, will appear similar to whats below.<br>
<a href="./Configuration _ M5_files/Config-Bits.png"><img src="./Configuration _ M5_files/Config-Bits.png" alt="" title="Config Bits" width="834" height="576" class="aligncenter size-full wp-image-2714" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits.png 834w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-300x207.png 300w" sizes="(max-width: 834px) 100vw, 834px"></a></p>
<p>A few things not mentioned in the <i>help contents</i>:<br>
<strong>JTAG occupies certain pins by default</strong></p>
<ul>
<li>unless <code>JTAGEN = OFF</code>, the four specific JTAG pins will default to JTAG mode and can‚Äôt be used for things like digital I/O</li>
<li>These pins are labelled  TMS, TDO, TCK, and TDI in the device pinout</li>
</ul>
<p><a href="./Configuration _ M5_files/Config-Bits-JTAG-pinout.png"><img src="./Configuration _ M5_files/Config-Bits-JTAG-pinout.png" alt="" title="Config Bits JTAG pinout" width="633" height="235" class="aligncenter size-full wp-image-2715" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-JTAG-pinout.png 844w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-JTAG-pinout-300x111.png 300w" sizes="(max-width: 633px) 100vw, 633px"></a></p>
<p><strong>Secondary Oscillator occupies certain pins by default</strong></p>
<ul>
<li>unless <code>FSOSCEN = OFF</code>, the two specific secondary oscillator pins will default as I/O pins for the secondary oscillator and can‚Äôt be used for things like digital I/O</li>
<li>These pins are labelled  SOSCI and SOSCO in the device pinout</li>
</ul>
<p><a href="./Configuration _ M5_files/Config-Bits-SOSCEN-pinout.png"><img src="./Configuration _ M5_files/Config-Bits-SOSCEN-pinout.png" alt="" title="Config Bits SOSCEN pinout" width="633" height="235" class="aligncenter size-full wp-image-2716" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-SOSCEN-pinout.png 844w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-SOSCEN-pinout-300x111.png 300w" sizes="(max-width: 633px) 100vw, 633px"></a></p>
<p><strong>System Clock Configuration</strong><br>
Configuring the system clock is way too complicated to fully explain here. However,  I‚Äôll explain how to get 40MHz on the PIC32MX220F032B (used in all these tutorials) with the internal oscillator. This is the fastest system clock speed and is stable enough for most situations except when using USB which requires the stability of an external crystal.</p>
<p>One of two PIC32 internal oscillators is the 8MHz FRC (fast resistor capacitor) oscillator. The other is the 31.25kHz LPRC (low power RC) oscillator. The FRC as well as external oscillator‚Äôs can be frequency scaled by an internal PLL (phase-locked loop) circuit. The input to the PLL must be between 4-5MHz and the system clock on each PIC has a maximum recommended frequency. For this reason, there is a frequency divider before and after the PLL.</p>
<p>For the PIC32MX220F032B to have it‚Äôs maximum system clock frequency of 40MHz, the following ‚Äòconfig bits‚Äô would be used along with the <code>SYSTEMConfigPerformance()</code> function discussed below.</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#pragma config FNOSC = FRCPLL   // Internal Fast RC oscillator (8 MHz) w/ PLL</span>
<span style="color: #339933;">#pragma config FPLLIDIV = DIV_2 // Divide FRC before PLL (now 4 MHz)</span>
<span style="color: #339933;">#pragma config FPLLMUL = MUL_20 // PLL Multiply (now 80 MHz)</span>
<span style="color: #339933;">#pragma config FPLLODIV = DIV_2 // Divide After PLL (now 40 MHz)</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">#pragma config FNOSC = FRCPLL   // Internal Fast RC oscillator (8 MHz) w/ PLL
#pragma config FPLLIDIV = DIV_2 // Divide FRC before PLL (now 4 MHz)
#pragma config FPLLMUL = MUL_20 // PLL Multiply (now 80 MHz)
#pragma config FPLLODIV = DIV_2 // Divide After PLL (now 40 MHz)</p></div>

<p>The circuit pathway is highlighted in this (once intimidating) block diagram taken from the datasheet.<br>
<a href="./Configuration _ M5_files/Config-Bits-FRCPLL.png"><img src="./Configuration _ M5_files/Config-Bits-FRCPLL.png" alt="" title="Config Bits FRCPLL" width="620" height="697" class="aligncenter size-full wp-image-2717" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-FRCPLL.png 620w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-FRCPLL-266x300.png 266w" sizes="(max-width: 620px) 100vw, 620px"></a></p>
<p><strong>Watchdog Timer</strong><br>
The watchdog timer is a counter powered by the LPRC (low power rc oscillator) that restarts the microcontroller is not reset periodically. It‚Äôs a great tool in many situations but is just an extra hassle for most small scale projects. The watchdog timer must also be OFF to debug. Note that if you try to use a debugger while it is set ON, MPLAB X will kindly ask for permission to shut it off while debugging. For these reasons, we generally keep the watchdog timer OFF with the following:</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#pragma config FWDTEN = OFF</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">#pragma config FWDTEN = OFF</p></div>

<p><strong>ICSP pin selection</strong><br>
The ICSP (in-circuit serial programming) lines are those in which the program is transferred from the programmer to the PIC itself. There are two lines, PGEC (clock) and PGED (data). The PIC32 is convenient in that the programmer has multiple options for which pins these two ICSP lines will be. They‚Äôre aptly named PGECx and PGEDx. In the M5 basic circuit tutorial, we used PGEC1/PGED1 which are also the default pins. If you wanted to use PGEC2/PGED2, use the following config bits:</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#pragma config ICESEL = ICS_PGx2</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">#pragma config ICESEL = ICS_PGx2</p></div>

<p>The pinout below shows where the different program pins are:<br>
<a href="./Configuration _ M5_files/Config-Bits-ICSP.png"><img src="./Configuration _ M5_files/Config-Bits-ICSP.png" alt="" title="Config Bits ICSP" width="633" height="235" class="aligncenter size-full wp-image-2722" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-ICSP.png 844w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-Bits-ICSP-300x111.png 300w" sizes="(max-width: 633px) 100vw, 633px"></a></p>
<h2>External Crystal Oscillator</h2>
<p>If you need a high-frequency system clock that is more accurate than the internal FRC oscillator, the <i>primary oscillator</i> is available. This involves a teensy amount of extra hardware as all configurations of the primary oscillator involve an external source. There are 3 modes, each of which can be connected to the same PLL circuit we‚Äôve been using to scale the frequency. </p>
<ul>
<li>External Resonator (XT): uses a crystal or resonator between the OSC1 and OSC2 pins</li>
<li>High Speed (HS): uses a crystal between the OSC1 and OSC2 pins</li>
<li>External Clock (EC): uses an external clock connected only to the OSC1 pin leaving OSC2 free</li>
</ul>
<p>When using a crystal as an external source, you have options between using the XT and HS modes. The XT mode uses medium power for medium frequencies ‚Äì roughly 200kHz to 4MHz crystals. The HS mode is higher power for the highest oscillator frequencies. To select between the XT, HS, and EC modes, you would deal with the <code>POSCMOD</code> configuration option. </p>
<p>When connecting an external crystal to a microcontroller, the circuit requires a capacitor connected from each of the two crystal pins to ground. See the ‚Äúprimary oscillator‚Äù section on the oscillator block diagram or the picture below for an example. When selecting these capacitor values, find the <i>load capacitance</i> on the datasheet and select capacitors that are about twice this value. Twice the rated load capacitance because we‚Äôre essentially putting two capacitors in series with each other dividing the total capacitance by two. The load capacitance for our crystal is rated at 18 pF (from crystal datasheet) so we‚Äôre using two 36 pF capacitors connected from the crystal pins to ground. If you don‚Äôt have the exact target capacitors, using substitute capacitors with similar values will work although you may pull the frequency a little high or a little low. If using a breadboard, each pin will have tons (~2-25pF) of <i>stray capacitance</i> making the choice for precision a difficult one <img draggable="false" class="emoji" alt="üôÇ" src="./Configuration _ M5_files/1f642.svg"> Breadboarding sort of fails when it comes applications above 20MHz or so for this reason‚Ä¶</p>
<p>The code and picture below demonstrate how to get the maximum 40MHz system clock with a 12MHz crystal external source in your projects.</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#pragma config POSCMOD=HS          // High speed crystal mode</span>
<span style="color: #339933;">#pragma config FNOSC=PRIPLL        // Use Primary Oscillator with PLL (XT, HS, or EC) </span>
<span style="color: #339933;">#pragma config FPLLIDIV=DIV_3      // Divide 12MHz to between 4-5MHz before PLL (now 4MHz)</span>
<span style="color: #339933;">#pragma config FPLLMUL=MUL_20      // Multiply with PLL (now 80MHz)</span>
<span style="color: #339933;">#pragma config FPLLODIV=DIV_2      // Divide After PLL (now 40 MHz)</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">#pragma config POSCMOD=HS          // High speed crystal mode
#pragma config FNOSC=PRIPLL        // Use Primary Oscillator with PLL (XT, HS, or EC) 
#pragma config FPLLIDIV=DIV_3      // Divide 12MHz to between 4-5MHz before PLL (now 4MHz)
#pragma config FPLLMUL=MUL_20      // Multiply with PLL (now 80MHz)
#pragma config FPLLODIV=DIV_2      // Divide After PLL (now 40 MHz)</p></div>

<p><a href="./Configuration _ M5_files/Config-external-osc1.jpg"><img src="./Configuration _ M5_files/Config-external-osc1.jpg" alt="" title="Config external osc" width="932" height="558" class="aligncenter size-full wp-image-3119" srcset="http://umassamherstm5.org/wp-content/uploads/2012/05/Config-external-osc1.jpg 932w, http://umassamherstm5.org/wp-content/uploads/2012/05/Config-external-osc1-300x179.jpg 300w" sizes="(max-width: 932px) 100vw, 932px"></a></p>
<h2>SYSTEMConfigPerformance()</h2>
<p>The <code>SYSTEMConfigPerformance()</code> function is included in the <code>plib.h</code> header file. It optimizes the performance of the PIC32 in a single function. ALWAYS include this function with your code! Super useful!</p>
<p>In particular, the <code>SYSTEMConfiPerformance()</code> function takes as it‚Äôs input argument the system clock frequency. It then optimizes access time to flash memory, enables the instruction and data caches, and enables the PIC32 cache module to jump ahead and read functions that aren‚Äôt being executed yet so there is often zero wait time for accessing those instructions. Again, ALWAYS INCLUDE THIS FUNCTION!! </p>
<p>Call this function from <code>main()</code> with it‚Äôs argument being the system clock frequency. For example:</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
    SYSTEMConfigPerformance<span style="color: #009900;">(</span><span style="color: #0000dd;">40000000</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">//...and on and on and on...</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">int main(){
    SYSTEMConfigPerformance(40000000);
    
    //...and on and on and on...
}</p></div>

<h2>Header Files</h2>
<p><strong>p32xxxx.h</strong><br>
When programming in C, this header file calls the chip specific header file defined in the <i>project properties</i>. When programming in assembly, much more is defined that won‚Äôt be discussed. </p>
<p>The key purpose of the chip specific header file invoked by p32xxxx.h, (p32mx220f032b.h, etc.) is to give names to different memory regions. It allows the programmer to reference special function registers by name rather than by address. It also allows for the existence of statements that reference specific bits in a special function register. Statements like:</p>

<div class="wp_syntax" style="position:relative;"><table><tbody><tr><td class="code"><pre class="c" style="font-family:monospace;">TRISB <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
SPI1CONbits.<span style="color: #202020;">CKE</span> <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span></pre></td></tr></tbody></table><p class="theCode" style="display:none;">TRISB = 0;
SPI1CONbits.CKE = 1;</p></div>

<p>The chip specific header file defines numbers that correspond to interrupt vectors and IRQ‚Äôs as well. Similar to the mapping of special function register names to memory locations as mentioned above, this just means that when dealing with interrupts, the programmer doesn‚Äôt have to remember a set of numbers but can deal with names.</p>
<p><strong>plib.h</strong><br>
Plib.h contains calls to the peripheral functions. These are functions that make programming much easier in theory. Instead of having to deal with specific bits in a special function register, the programmer can do the same work in a single line with descriptive functions. For example, SYSTEMConfigPerformance() is defined through plib.h and is incredibly convenient. Unfortunately, on more than one occasion I‚Äôve encountered a function in someone else‚Äôs code for which there seemed to be no information describing how to use it. Sometimes a function would work in one version of the C32 compiler but not a new version. The point being that the use of these functions often makes programs more difficult to modify and port. For that reason, these tutorials will try to stay away from the use of most peripheral functions.</p>
<p><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/32bitPeripheralLibraryGuide.pdf" title="PIC32 Peripheral Library Guide" target="_blank">Here</a> is a guide to the relatively stable PIC32 peripheral functions.</p>
											</div><!-- .entry-content -->

					<footer class="entry-meta">
											</footer><!-- .entry-meta -->
				</article><!-- #post -->

				
<div id="comments" class="comments-area">

			<h2 class="comments-title">
			6 thoughts on ‚Äú<span>Configuration</span>‚Äù		</h2>

		<ol class="comment-list">
					<li id="comment-802" class="comment even thread-even depth-1">
			<article id="div-comment-802" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/132d00a8011c5a4c4e4ce45c980c35c5.png" srcset="http://1.gravatar.com/avatar/132d00a8011c5a4c4e4ce45c980c35c5?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Joe</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-802">
							<time datetime="2012-08-30T18:56:31+00:00">
								30 August 2012 at 18:56							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you for the information on the configuration bits.  Finally got my PIC32MX150F128B working at  40Mhz <img draggable="false" class="emoji" alt="üôÇ" src="./Configuration _ M5_files/1f642.svg"></p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=802#respond" onclick="return addComment.moveForm( &quot;div-comment-802&quot;, &quot;802&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to Joe">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-892" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-892" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/f1332eef8cb0c552a88a165bba312e06.png" srcset="http://0.gravatar.com/avatar/f1332eef8cb0c552a88a165bba312e06?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn"><a href="http://digital-diy.com/" rel="external nofollow" class="url">Gary Rubin (Hop)</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-892">
							<time datetime="2012-10-01T15:54:48+00:00">
								1 October 2012 at 15:54							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I just made the transition to PIC32MX from 18F4550, 18F24J50, etc. It was hard to move from a working MCU in my PWM controller project, but I wanted more processing power and the larger memory. This tutorial covered a major hurdle for me, and for that, I thank you!!!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=892#respond" onclick="return addComment.moveForm( &quot;div-comment-892&quot;, &quot;892&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to Gary Rubin (Hop)">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-1650" class="comment even thread-even depth-1">
			<article id="div-comment-1650" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/04ef3373f36c545ec5c94342bbfa1952.png" srcset="http://0.gravatar.com/avatar/04ef3373f36c545ec5c94342bbfa1952?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Joaquim</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-1650">
							<time datetime="2013-01-29T03:17:06+00:00">
								29 January 2013 at 03:17							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>That was very usefull!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=1650#respond" onclick="return addComment.moveForm( &quot;div-comment-1650&quot;, &quot;1650&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to Joaquim">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-11406" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-11406" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/82a8099132de93fe34f0fe8f04aa206c.png" srcset="http://2.gravatar.com/avatar/82a8099132de93fe34f0fe8f04aa206c?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Jason F</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-11406">
							<time datetime="2014-07-17T23:25:10+00:00">
								17 July 2014 at 23:25							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you so much. You made my work so much easier!!!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=11406#respond" onclick="return addComment.moveForm( &quot;div-comment-11406&quot;, &quot;11406&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to Jason F">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-39734" class="comment even thread-even depth-1">
			<article id="div-comment-39734" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/81c04b37fc4c6cc6dc509f861d5e6749.png" srcset="http://2.gravatar.com/avatar/81c04b37fc4c6cc6dc509f861d5e6749?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">danm</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-39734">
							<time datetime="2015-09-08T05:24:13+00:00">
								8 September 2015 at 05:24							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi , Very informative and useful site for those wanting to learn pic32. Could you do same for PIC32MZ particularly how to output directly FRC to RefClock out pin. Thanks!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=39734#respond" onclick="return addComment.moveForm( &quot;div-comment-39734&quot;, &quot;39734&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to danm">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-43181" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-43181" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt="" src="./Configuration _ M5_files/77b0bafbd2b341b149ca56c5243f31e2.png" srcset="http://1.gravatar.com/avatar/77b0bafbd2b341b149ca56c5243f31e2?s=148&amp;d=mm&amp;r=g 2x" class="avatar avatar-74 photo" height="74" width="74">						<b class="fn">Abhinav</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#comment-43181">
							<time datetime="2015-12-30T00:47:07+00:00">
								30 December 2015 at 00:47							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I read your article. Its very helpful. I am using a 8mhz external crystal and included the pragma configs according to your article.</p>
<p>#define FCY 72000000UL<br>
#define FPB (FCY/2)<br>
#define BAUDRATE    9600<br>
#pragma config POSCMOD=HS,FNOSC=PRIPLL //FNOSC=PRIPLL<br>
#pragma config FPLLIDIV=DIV_2, FPLLMUL=MUL_18, FPLLODIV=DIV_1<br>
#pragma config FPBDIV=DIV_2, FWDTEN=OFF//, CP=OFF, BWP=OFF</p>
<p>and then in main I am including SYSTEMConfigPerformance(FCY);<br>
I am doing a UART program and when I include  SYSTEMConfigPerformance(FCY); I receive null characters but when I remove SYSTEMConfigPerformance(FCY); UART program works perfect.<br>
What could be the problem for this.?</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel="nofollow" class="comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration?replytocom=43181#respond" onclick="return addComment.moveForm( &quot;div-comment-43181&quot;, &quot;43181&quot;, &quot;respond&quot;, &quot;2713&quot; )" aria-label="Reply to Abhinav">Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
		
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://umassamherstm5.org/tech-tutorials/pic32-tutorials/pic32mx220-tutorials/configuration#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="http://umassamherstm5.org/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate="">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required="true" required="required"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required="true" required="required"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200"></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="2713" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="4ee18e29a8"></p><p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1532266071685"></form>
			</div><!-- #respond -->
	
</div><!-- #comments -->			
		</div><!-- #content -->
	</div><!-- #primary -->


		</div><!-- #main -->
		<footer id="colophon" class="site-footer" role="contentinfo">
			
			<div class="site-info">
								<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #page -->

				<script type="text/javascript">
				(function($){
					$(function(){
						$("img.flickr.square,img.flickr.thumbnail,img.flickr.small").flightbox({size_callback: get_sizes});
					});
				})(jQuery);
			</script>
		<script type="text/javascript" src="./Configuration _ M5_files/form.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/wp-syntax.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/comment-reply.min.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/functions.js.download"></script>
<script type="text/javascript" src="./Configuration _ M5_files/wp-embed.min.js.download"></script>

</body></html>